import*as ast from"./ast.js";import{make_node}from"./utils/index.js";import{AST_Accessor,AST_Array,AST_Arrow,AST_Assign,AST_Atom,AST_Await,AST_BigInt,AST_Binary,AST_Block,AST_BlockStatement,AST_Boolean,AST_Break,AST_Call,AST_Case,AST_Catch,AST_Chain,AST_Class,AST_ClassExpression,AST_ClassProperty,AST_ClassPrivateProperty,AST_ConciseMethod,AST_Conditional,AST_Const,AST_Constant,AST_Continue,AST_Debugger,AST_Default,AST_DefaultAssign,AST_DefClass,AST_Definitions,AST_Defun,AST_Destructuring,AST_Directive,AST_Do,AST_Dot,AST_DotHash,AST_EmptyStatement,AST_Expansion,AST_Export,AST_False,AST_Finally,AST_For,AST_ForIn,AST_ForOf,AST_Function,AST_Hole,AST_If,AST_Import,AST_ImportMeta,AST_Label,AST_LabeledStatement,AST_LabelRef,AST_Lambda,AST_Let,AST_NameMapping,AST_New,AST_NewTarget,AST_Node,AST_Null,AST_Number,AST_Object,AST_ObjectGetter,AST_ObjectKeyVal,AST_ObjectProperty,AST_ObjectSetter,AST_PrefixedTemplateString,AST_PrivateGetter,AST_PrivateMethod,AST_PrivateSetter,AST_PropAccess,AST_RegExp,AST_Return,AST_Sequence,AST_SimpleStatement,AST_Statement,AST_String,AST_Sub,AST_Super,AST_Switch,AST_SwitchBranch,AST_Symbol,AST_SymbolCatch,AST_SymbolClass,AST_SymbolClassProperty,AST_SymbolConst,AST_SymbolDefClass,AST_SymbolDefun,AST_SymbolExport,AST_SymbolExportForeign,AST_SymbolFunarg,AST_SymbolImport,AST_SymbolImportForeign,AST_SymbolLambda,AST_SymbolLet,AST_SymbolMethod,AST_SymbolRef,AST_SymbolVar,AST_TemplateSegment,AST_TemplateString,AST_This,AST_Throw,AST_Token,AST_Toplevel,AST_True,AST_Try,AST_Unary,AST_UnaryPostfix,AST_UnaryPrefix,AST_Var,AST_VarDef,AST_While,AST_With,AST_Yield}from"./ast.js";import{is_basic_identifier_string}from"./parse.js";!function(){var e=function(e){for(var t=!0,n=0;n<e.length;n++)t&&e[n]instanceof AST_Statement&&e[n].body instanceof AST_String?e[n]=new AST_Directive({start:e[n].start,end:e[n].end,value:e[n].body.value}):!t||e[n]instanceof AST_Statement&&e[n].body instanceof AST_String||(t=!1);return e};const t=e=>e&&e.length>0?new AST_Object({start:a(e),end:o(e),properties:e.map((e=>new AST_ObjectKeyVal({start:a(e),end:o(e),key:e.key.name||e.key.value,value:l(e.value)})))}):null;var n={Program:function(t){return new AST_Toplevel({start:a(t),end:o(t),body:e(t.body.map(l))})},ArrayPattern:function(e){return new AST_Destructuring({start:a(e),end:o(e),names:e.elements.map((function(e){return null===e?new AST_Hole:l(e)})),is_array:!0})},ObjectPattern:function(e){return new AST_Destructuring({start:a(e),end:o(e),names:e.properties.map(l),is_array:!1})},AssignmentPattern:function(e){return new AST_DefaultAssign({start:a(e),end:o(e),left:l(e.left),operator:"=",right:l(e.right)})},SpreadElement:function(e){return new AST_Expansion({start:a(e),end:o(e),expression:l(e.argument)})},RestElement:function(e){return new AST_Expansion({start:a(e),end:o(e),expression:l(e.argument)})},TemplateElement:function(e){return new AST_TemplateSegment({start:a(e),end:o(e),value:e.value.cooked,raw:e.value.raw})},TemplateLiteral:function(e){for(var t=[],n=0;n<e.quasis.length;n++)t.push(l(e.quasis[n])),e.expressions[n]&&t.push(l(e.expressions[n]));return new AST_TemplateString({start:a(e),end:o(e),segments:t})},TaggedTemplateExpression:function(e){return new AST_PrefixedTemplateString({start:a(e),end:o(e),template_string:l(e.quasi),prefix:l(e.tag)})},FunctionDeclaration:function(t){return new AST_Defun({start:a(t),end:o(t),name:l(t.id),argnames:t.params.map(l),is_generator:t.generator,async:t.async,body:e(l(t.body).body)})},FunctionExpression:function(t){return new AST_Function({start:a(t),end:o(t),name:l(t.id),argnames:t.params.map(l),is_generator:t.generator,async:t.async,body:e(l(t.body).body)})},ArrowFunctionExpression:function(e){const t="BlockStatement"===e.body.type?l(e.body).body:[make_node(AST_Return,{},{value:l(e.body)})];return new AST_Arrow({start:a(e),end:o(e),argnames:e.params.map(l),body:t,async:e.async})},ExpressionStatement:function(e){return new AST_SimpleStatement({start:a(e),end:o(e),body:l(e.expression)})},TryStatement:function(e){var t=e.handlers||[e.handler];if(t.length>1||e.guardedHandlers&&e.guardedHandlers.length)throw new Error("Multiple catch clauses are not supported.");return new AST_Try({start:a(e),end:o(e),body:l(e.block).body,bcatch:l(t[0]),bfinally:e.finalizer?new AST_Finally(l(e.finalizer)):null})},Property:function(e){var t=e.key,n={start:a(t||e.value),end:o(e.value),key:"Identifier"==t.type?t.name:t.value,value:l(e.value)};return e.computed&&(n.key=l(e.key)),e.method?(n.is_generator=e.value.generator,n.async=e.value.async,e.computed?n.key=l(e.key):n.key=new AST_SymbolMethod({name:n.key}),new AST_ConciseMethod(n)):"init"==e.kind?("Identifier"!=t.type&&"Literal"!=t.type&&(n.key=l(t)),new AST_ObjectKeyVal(n)):("string"!=typeof n.key&&"number"!=typeof n.key||(n.key=new AST_SymbolMethod({name:n.key})),n.value=new AST_Accessor(n.value),"get"==e.kind?new AST_ObjectGetter(n):"set"==e.kind?new AST_ObjectSetter(n):"method"==e.kind?(n.async=e.value.async,n.is_generator=e.value.generator,n.quote=e.computed?'"':null,new AST_ConciseMethod(n)):void 0)},MethodDefinition:function(e){var t={start:a(e),end:o(e),key:e.computed?l(e.key):new AST_SymbolMethod({name:e.key.name||e.key.value}),value:l(e.value),static:e.static};return"get"==e.kind?new AST_ObjectGetter(t):"set"==e.kind?new AST_ObjectSetter(t):(t.is_generator=e.value.generator,t.async=e.value.async,new AST_ConciseMethod(t))},FieldDefinition:function(e){let t;if(e.computed)t=l(e.key);else{if("Identifier"!==e.key.type)throw new Error("Non-Identifier key in FieldDefinition");t=l(e.key)}return new AST_ClassProperty({start:a(e),end:o(e),key:t,value:l(e.value),static:e.static})},PropertyDefinition:function(e){let t;if(e.computed)t=l(e.key);else{if("Identifier"!==e.key.type)throw new Error("Non-Identifier key in PropertyDefinition");t=l(e.key)}return new AST_ClassProperty({start:a(e),end:o(e),key:t,value:l(e.value),static:e.static})},ArrayExpression:function(e){return new AST_Array({start:a(e),end:o(e),elements:e.elements.map((function(e){return null===e?new AST_Hole:l(e)}))})},ObjectExpression:function(e){return new AST_Object({start:a(e),end:o(e),properties:e.properties.map((function(e){return"SpreadElement"===e.type||(e.type="Property"),l(e)}))})},SequenceExpression:function(e){return new AST_Sequence({start:a(e),end:o(e),expressions:e.expressions.map(l)})},MemberExpression:function(e){return new(e.computed?AST_Sub:AST_Dot)({start:a(e),end:o(e),property:e.computed?l(e.property):e.property.name,expression:l(e.object),optional:e.optional||!1})},ChainExpression:function(e){return new AST_Chain({start:a(e),end:o(e),expression:l(e.expression)})},SwitchCase:function(e){return new(e.test?AST_Case:AST_Default)({start:a(e),end:o(e),expression:l(e.test),body:e.consequent.map(l)})},VariableDeclaration:function(e){return new("const"===e.kind?AST_Const:"let"===e.kind?AST_Let:AST_Var)({start:a(e),end:o(e),definitions:e.declarations.map(l)})},ImportDeclaration:function(e){var n=null,r=null;return e.specifiers.forEach((function(e){"ImportSpecifier"===e.type?(r||(r=[]),r.push(new AST_NameMapping({start:a(e),end:o(e),foreign_name:l(e.imported),name:l(e.local)}))):"ImportDefaultSpecifier"===e.type?n=l(e.local):"ImportNamespaceSpecifier"===e.type&&(r||(r=[]),r.push(new AST_NameMapping({start:a(e),end:o(e),foreign_name:new AST_SymbolImportForeign({name:"*"}),name:l(e.local)})))})),new AST_Import({start:a(e),end:o(e),imported_name:n,imported_names:r,module_name:l(e.source),assert_clause:t(e.assertions)})},ExportAllDeclaration:function(e){return new AST_Export({start:a(e),end:o(e),exported_names:[new AST_NameMapping({name:new AST_SymbolExportForeign({name:"*"}),foreign_name:new AST_SymbolExportForeign({name:"*"})})],module_name:l(e.source),assert_clause:t(e.assertions)})},ExportNamedDeclaration:function(e){return new AST_Export({start:a(e),end:o(e),exported_definition:l(e.declaration),exported_names:e.specifiers&&e.specifiers.length?e.specifiers.map((function(e){return new AST_NameMapping({foreign_name:l(e.exported),name:l(e.local)})})):null,module_name:l(e.source),assert_clause:t(e.assertions)})},ExportDefaultDeclaration:function(e){return new AST_Export({start:a(e),end:o(e),exported_value:l(e.declaration),is_default:!0})},Literal:function(e){var t=e.value,n={start:a(e),end:o(e)},r=e.regex;if(r&&r.pattern)return n.value={source:r.pattern,flags:r.flags},new AST_RegExp(n);if(r){const r=e.raw||t,a=r.match(/^\/(.*)\/(\w*)$/);if(!a)throw new Error("Invalid regex source "+r);const[o,i,s]=a;return n.value={source:i,flags:s},new AST_RegExp(n)}if(null===t)return new AST_Null(n);switch(typeof t){case"string":return n.value=t,new AST_String(n);case"number":return n.value=t,n.raw=e.raw||t.toString(),new AST_Number(n);case"boolean":return new(t?AST_True:AST_False)(n)}},MetaProperty:function(e){return"new"===e.meta.name&&"target"===e.property.name?new AST_NewTarget({start:a(e),end:o(e)}):"import"===e.meta.name&&"meta"===e.property.name?new AST_ImportMeta({start:a(e),end:o(e)}):void 0},Identifier:function(e){var t=s[s.length-2];return new("LabeledStatement"==t.type?AST_Label:"VariableDeclarator"==t.type&&t.id===e?"const"==t.kind?AST_SymbolConst:"let"==t.kind?AST_SymbolLet:AST_SymbolVar:/Import.*Specifier/.test(t.type)?t.local===e?AST_SymbolImport:AST_SymbolImportForeign:"ExportSpecifier"==t.type?t.local===e?AST_SymbolExport:AST_SymbolExportForeign:"FunctionExpression"==t.type?t.id===e?AST_SymbolLambda:AST_SymbolFunarg:"FunctionDeclaration"==t.type?t.id===e?AST_SymbolDefun:AST_SymbolFunarg:"ArrowFunctionExpression"==t.type?t.params.includes(e)?AST_SymbolFunarg:AST_SymbolRef:"ClassExpression"==t.type?t.id===e?AST_SymbolClass:AST_SymbolRef:"Property"==t.type?t.key===e&&t.computed||t.value===e?AST_SymbolRef:AST_SymbolMethod:"PropertyDefinition"==t.type||"FieldDefinition"===t.type?t.key===e&&t.computed||t.value===e?AST_SymbolRef:AST_SymbolClassProperty:"ClassDeclaration"==t.type?t.id===e?AST_SymbolDefClass:AST_SymbolRef:"MethodDefinition"==t.type?t.computed?AST_SymbolRef:AST_SymbolMethod:"CatchClause"==t.type?AST_SymbolCatch:"BreakStatement"==t.type||"ContinueStatement"==t.type?AST_LabelRef:AST_SymbolRef)({start:a(e),end:o(e),name:e.name})},BigIntLiteral:e=>new AST_BigInt({start:a(e),end:o(e),value:e.value})};n.UpdateExpression=n.UnaryExpression=function(e){return new(("prefix"in e?e.prefix:"UnaryExpression"==e.type)?AST_UnaryPrefix:AST_UnaryPostfix)({start:a(e),end:o(e),operator:e.operator,expression:l(e.argument)})},n.ClassDeclaration=n.ClassExpression=function(e){return new("ClassDeclaration"===e.type?AST_DefClass:AST_ClassExpression)({start:a(e),end:o(e),name:l(e.id),extends:l(e.superClass),properties:e.body.body.map(l)})},i("EmptyStatement",AST_EmptyStatement),i("BlockStatement",AST_BlockStatement,"body@body"),i("IfStatement",AST_If,"test>condition, consequent>body, alternate>alternative"),i("LabeledStatement",AST_LabeledStatement,"label>label, body>body"),i("BreakStatement",AST_Break,"label>label"),i("ContinueStatement",AST_Continue,"label>label"),i("WithStatement",AST_With,"object>expression, body>body"),i("SwitchStatement",AST_Switch,"discriminant>expression, cases@body"),i("ReturnStatement",AST_Return,"argument>value"),i("ThrowStatement",AST_Throw,"argument>value"),i("WhileStatement",AST_While,"test>condition, body>body"),i("DoWhileStatement",AST_Do,"test>condition, body>body"),i("ForStatement",AST_For,"init>init, test>condition, update>step, body>body"),i("ForInStatement",AST_ForIn,"left>init, right>object, body>body"),i("ForOfStatement",AST_ForOf,"left>init, right>object, body>body, await=await"),i("AwaitExpression",AST_Await,"argument>expression"),i("YieldExpression",AST_Yield,"argument>expression, delegate=is_star"),i("DebuggerStatement",AST_Debugger),i("VariableDeclarator",AST_VarDef,"id>name, init>value"),i("CatchClause",AST_Catch,"param>argname, body%body"),i("ThisExpression",AST_This),i("Super",AST_Super),i("BinaryExpression",AST_Binary,"operator=operator, left>left, right>right"),i("LogicalExpression",AST_Binary,"operator=operator, left>left, right>right"),i("AssignmentExpression",AST_Assign,"operator=operator, left>left, right>right"),i("ConditionalExpression",AST_Conditional,"test>condition, consequent>consequent, alternate>alternative"),i("NewExpression",AST_New,"callee>expression, arguments@args"),i("CallExpression",AST_Call,"callee>expression, optional=optional, arguments@args"),p(AST_Toplevel,(function(e){return c("Program",e)})),p(AST_Expansion,(function(e){return{type:m()?"RestElement":"SpreadElement",argument:u(e.expression)}})),p(AST_PrefixedTemplateString,(function(e){return{type:"TaggedTemplateExpression",tag:u(e.prefix),quasi:u(e.template_string)}})),p(AST_TemplateString,(function(e){for(var t=[],n=[],r=0;r<e.segments.length;r++)r%2!=0?n.push(u(e.segments[r])):t.push({type:"TemplateElement",value:{raw:e.segments[r].raw,cooked:e.segments[r].value},tail:r===e.segments.length-1});return{type:"TemplateLiteral",quasis:t,expressions:n}})),p(AST_Defun,(function(e){return{type:"FunctionDeclaration",id:u(e.name),params:e.argnames.map(u),generator:e.is_generator,async:e.async,body:c("BlockStatement",e)}})),p(AST_Function,(function(e,t){var n=void 0!==t.is_generator?t.is_generator:e.is_generator;return{type:"FunctionExpression",id:u(e.name),params:e.argnames.map(u),generator:n,async:e.async,body:c("BlockStatement",e)}})),p(AST_Arrow,(function(e){var t={type:"BlockStatement",body:e.body.map(u)};return{type:"ArrowFunctionExpression",params:e.argnames.map(u),async:e.async,body:t}})),p(AST_Destructuring,(function(e){return e.is_array?{type:"ArrayPattern",elements:e.names.map(u)}:{type:"ObjectPattern",properties:e.names.map(u)}})),p(AST_Directive,(function(e){return{type:"ExpressionStatement",expression:{type:"Literal",value:e.value,raw:e.print_to_string()},directive:e.value}})),p(AST_SimpleStatement,(function(e){return{type:"ExpressionStatement",expression:u(e.body)}})),p(AST_SwitchBranch,(function(e){return{type:"SwitchCase",test:u(e.expression),consequent:e.body.map(u)}})),p(AST_Try,(function(e){return{type:"TryStatement",block:_(e),handler:u(e.bcatch),guardedHandlers:[],finalizer:u(e.bfinally)}})),p(AST_Catch,(function(e){return{type:"CatchClause",param:u(e.argname),guard:null,body:_(e)}})),p(AST_Definitions,(function(e){return{type:"VariableDeclaration",kind:e instanceof AST_Const?"const":e instanceof AST_Let?"let":"var",declarations:e.definitions.map(u)}}));const r=e=>{const t=[];if(e)for(const{key:n,value:r}of e.properties){const e=is_basic_identifier_string(n)?{type:"Identifier",name:n}:{type:"Literal",value:n,raw:JSON.stringify(n)};t.push({type:"ImportAttribute",key:e,value:u(r)})}return t};function a(e){var t=e.loc,n=t&&t.start,r=e.range;return new AST_Token("","",n&&n.line||0,n&&n.column||0,r?r[0]:e.start,!1,[],[],t&&t.source)}function o(e){var t=e.loc,n=t&&t.end,r=e.range;return new AST_Token("","",n&&n.line||0,n&&n.column||0,r?r[0]:e.end,!1,[],[],t&&t.source)}function i(e,t,r){var i="function From_Moz_"+e+"(M){\n";i+="return new U2."+t.name+"({\nstart: my_start_token(M),\nend: my_end_token(M)";var s="function To_Moz_"+e+"(M){\n";s+="return {\ntype: "+JSON.stringify(e),r&&r.split(/\s*,\s*/).forEach((function(e){var t=/([a-z0-9$_]+)([=@>%])([a-z0-9$_]+)/i.exec(e);if(!t)throw new Error("Can't understand property map: "+e);var n=t[1],r=t[2],a=t[3];switch(i+=",\n"+a+": ",s+=",\n"+n+": ",r){case"@":i+="M."+n+".map(from_moz)",s+="M."+a+".map(to_moz)";break;case">":i+="from_moz(M."+n+")",s+="to_moz(M."+a+")";break;case"=":i+="M."+n,s+="M."+a;break;case"%":i+="from_moz(M."+n+").body",s+="to_moz_block(M)";break;default:throw new Error("Can't understand operator in propmap: "+e)}})),i+="\n})\n}",s+="\n}\n}",i=new Function("U2","my_start_token","my_end_token","from_moz","return("+i+")")(ast,a,o,l),s=new Function("to_moz","to_moz_block","to_moz_scope","return("+s+")")(u,_,c),n[e]=i,p(t,s)}p(AST_Export,(function(e){return e.exported_names?"*"===e.exported_names[0].name.name?{type:"ExportAllDeclaration",source:u(e.module_name),assertions:r(e.assert_clause)}:{type:"ExportNamedDeclaration",specifiers:e.exported_names.map((function(e){return{type:"ExportSpecifier",exported:u(e.foreign_name),local:u(e.name)}})),declaration:u(e.exported_definition),source:u(e.module_name),assertions:r(e.assert_clause)}:{type:e.is_default?"ExportDefaultDeclaration":"ExportNamedDeclaration",declaration:u(e.exported_value||e.exported_definition)}})),p(AST_Import,(function(e){var t=[];return e.imported_name&&t.push({type:"ImportDefaultSpecifier",local:u(e.imported_name)}),e.imported_names&&"*"===e.imported_names[0].foreign_name.name?t.push({type:"ImportNamespaceSpecifier",local:u(e.imported_names[0].name)}):e.imported_names&&e.imported_names.forEach((function(e){t.push({type:"ImportSpecifier",local:u(e.name),imported:u(e.foreign_name)})})),{type:"ImportDeclaration",specifiers:t,source:u(e.module_name),assertions:r(e.assert_clause)}})),p(AST_ImportMeta,(function(){return{type:"MetaProperty",meta:{type:"Identifier",name:"import"},property:{type:"Identifier",name:"meta"}}})),p(AST_Sequence,(function(e){return{type:"SequenceExpression",expressions:e.expressions.map(u)}})),p(AST_DotHash,(function(e){return{type:"MemberExpression",object:u(e.expression),computed:!1,property:{type:"PrivateIdentifier",name:e.property},optional:e.optional}})),p(AST_PropAccess,(function(e){var t=e instanceof AST_Sub;return{type:"MemberExpression",object:u(e.expression),computed:t,property:t?u(e.property):{type:"Identifier",name:e.property},optional:e.optional}})),p(AST_Chain,(function(e){return{type:"ChainExpression",expression:u(e.expression)}})),p(AST_Unary,(function(e){return{type:"++"==e.operator||"--"==e.operator?"UpdateExpression":"UnaryExpression",operator:e.operator,prefix:e instanceof AST_UnaryPrefix,argument:u(e.expression)}})),p(AST_Binary,(function(e){if("="==e.operator&&m())return{type:"AssignmentPattern",left:u(e.left),right:u(e.right)};return{type:"&&"==e.operator||"||"==e.operator||"??"===e.operator?"LogicalExpression":"BinaryExpression",left:u(e.left),operator:e.operator,right:u(e.right)}})),p(AST_Array,(function(e){return{type:"ArrayExpression",elements:e.elements.map(u)}})),p(AST_Object,(function(e){return{type:"ObjectExpression",properties:e.properties.map(u)}})),p(AST_ObjectProperty,(function(e,t){var n,r=e.key instanceof AST_Node?u(e.key):{type:"Identifier",value:e.key};"number"==typeof e.key&&(r={type:"Literal",value:Number(e.key)}),"string"==typeof e.key&&(r={type:"Identifier",name:e.key});var a="string"==typeof e.key||"number"==typeof e.key,o=!a&&(!(e.key instanceof AST_Symbol)||e.key instanceof AST_SymbolRef);if(e instanceof AST_ObjectKeyVal?(n="init",o=!a):e instanceof AST_ObjectGetter?n="get":e instanceof AST_ObjectSetter&&(n="set"),e instanceof AST_PrivateGetter||e instanceof AST_PrivateSetter){return{type:"MethodDefinition",computed:!1,kind:e instanceof AST_PrivateGetter?"get":"set",static:e.static,key:{type:"PrivateIdentifier",name:e.key.name},value:u(e.value)}}return e instanceof AST_ClassPrivateProperty?{type:"PropertyDefinition",key:{type:"PrivateIdentifier",name:e.key.name},value:u(e.value),computed:!1,static:e.static}:e instanceof AST_ClassProperty?{type:"PropertyDefinition",key:r,value:u(e.value),computed:o,static:e.static}:t instanceof AST_Class?{type:"MethodDefinition",computed:o,kind:n,static:e.static,key:u(e.key),value:u(e.value)}:{type:"Property",computed:o,kind:n,key:r,value:u(e.value)}})),p(AST_ConciseMethod,(function(e,t){if(t instanceof AST_Object)return{type:"Property",computed:!(e.key instanceof AST_Symbol)||e.key instanceof AST_SymbolRef,kind:"init",method:!0,shorthand:!1,key:u(e.key),value:u(e.value)};const n=e instanceof AST_PrivateMethod?{type:"PrivateIdentifier",name:e.key.name}:u(e.key);return{type:"MethodDefinition",kind:"constructor"===e.key?"constructor":"method",key:n,value:u(e.value),computed:!(e.key instanceof AST_Symbol)||e.key instanceof AST_SymbolRef,static:e.static}})),p(AST_Class,(function(e){return{type:e instanceof AST_ClassExpression?"ClassExpression":"ClassDeclaration",superClass:u(e.extends),id:e.name?u(e.name):null,body:{type:"ClassBody",body:e.properties.map(u)}}})),p(AST_NewTarget,(function(){return{type:"MetaProperty",meta:{type:"Identifier",name:"new"},property:{type:"Identifier",name:"target"}}})),p(AST_Symbol,(function(e,t){if(e instanceof AST_SymbolMethod&&t.quote)return{type:"Literal",value:e.name};var n=e.definition();return{type:"Identifier",name:n?n.mangled_name||n.name:e.name}})),p(AST_RegExp,(function(e){const t=e.value.source,n=e.value.flags;return{type:"Literal",value:null,raw:e.print_to_string(),regex:{pattern:t,flags:n}}})),p(AST_Constant,(function(e){return{type:"Literal",value:e.value,raw:e.raw||e.print_to_string()}})),p(AST_Atom,(function(e){return{type:"Identifier",name:String(e.value)}})),p(AST_BigInt,(e=>({type:"BigIntLiteral",value:e.value}))),AST_Boolean.DEFMETHOD("to_mozilla_ast",AST_Constant.prototype.to_mozilla_ast),AST_Null.DEFMETHOD("to_mozilla_ast",AST_Constant.prototype.to_mozilla_ast),AST_Hole.DEFMETHOD("to_mozilla_ast",(function(){return null})),AST_Block.DEFMETHOD("to_mozilla_ast",AST_BlockStatement.prototype.to_mozilla_ast),AST_Lambda.DEFMETHOD("to_mozilla_ast",AST_Function.prototype.to_mozilla_ast);var s=null;function l(e){s.push(e);var t=null!=e?n[e.type](e):null;return s.pop(),t}function p(e,t){e.DEFMETHOD("to_mozilla_ast",(function(e){return n=this,r=t(this,e),a=n.start,o=n.end,a&&o?(null!=a.pos&&null!=o.endpos&&(r.range=[a.pos,o.endpos]),a.line&&(r.loc={start:{line:a.line,column:a.col},end:o.endline?{line:o.endline,column:o.endcol}:null},a.file&&(r.loc.source=a.file)),r):r;var n,r,a,o}))}AST_Node.from_mozilla_ast=function(e){var t=s;s=[];var n=l(e);return s=t,n};var S=null;function u(e){null===S&&(S=[]),S.push(e);var t=null!=e?e.to_mozilla_ast(S[S.length-2]):null;return S.pop(),0===S.length&&(S=null),t}function m(){for(var e=S.length;e--;)if(S[e]instanceof AST_Destructuring)return!0;return!1}function _(e){return{type:"BlockStatement",body:e.body.map(u)}}function c(e,t){var n=t.body.map(u);return t.body[0]instanceof AST_SimpleStatement&&t.body[0].body instanceof AST_String&&n.unshift(u(new AST_EmptyStatement(t.body[0]))),{type:e,body:n}}}();